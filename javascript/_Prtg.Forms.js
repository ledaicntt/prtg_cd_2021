(function($,window,document,undefined){var pluginName="prtg-form";function prtgForm(element,data,parent){this.data=data;this.el=!(element instanceof jQuery)?element:element[0];this.$el=!(element instanceof jQuery)?$(element):element;this.namespace=_Prtg.Util.uniqueId("prtgform");this.needsserverrestart=false;this.dorestart=false;this.floatButtonProperties={};this.dataTables=[];this.init()}prtgForm.prototype.init=function(){var self=this;this.$el.removeAttr("tile").find("input").prtgFieldsetToggler();
this.$el.find("textarea.fieldrequired, select.fieldrequired").each(function(){var $this=$(this);var $icon=$this.next(".required-icon").detach();$icon.addClass("textarea-required");$this.before($icon);$this.addClass("textarea-fieldrequired");$this.wrap('<span class="inputfield" />')});this.$el.find("button[prop]").on("click",function(){$(this).replaceWith('<input id="mypasshash" type="text" readonly="readonly" value="'+$(this).attr("prop")+'"></div>')});this.$el.find("button#newpasshash").on("click",
function(event){var userID=$("#objectdataform input[name=id]").val()||location.search.split("id=")[1].split("&")[0],$newpasshashBtn=$(this);event.preventDefault();$.ajax({url:"api/newpasshash.htm?id="+userID,type:"POST",dataType:"html",success:function(res){var msg=_Prtg.Lang.common.strings.newpasshashfail;if(!isNaN(res)){if($("#mypasshash").length){$("#mypasshash").val(res);$("#mypasshash").stop().css("background-color","#ffffcc").animate({backgroundColor:"#f3f2f2"},500,"easeInCubic")}else{$("#objectdataform button[prop]").click();
$("#mypasshash").val(res)}msg=_Prtg.Lang.common.strings.newpasshashsuccess}$newpasshashBtn.replaceWith('<input disabled="disabled" id="newpasshash" type="text" readonly="readonly" value="'+msg+'"></div>')}})});this.$el.find(".colorselector").each(function(){var $this=$(this),picker=$this.parent().append("<div />").children().last();$this.on("change."+self.namespace,function(){picker.setColor($(this).val())});picker=$.farbtastic(picker,function(color){$this.css("background-color",color);$this.val(color)});
if($this.val().length===0)$this.val("#000000").trigger("change")});this.$el.find('#priority_,#priority,input[name="priority_"]').favstarsinput();this.$el.find('#tags_,input[name="tags_"],#tagfilter_,#filtertag_,#libtagfilter_').tagsinput({"tags":self.getUserTags});this.$el.find('input[name="parenttags_"]').tagsinput({"readonly":true,"autocomplete":false});this.$el.find("table.datatables, table.hoverable").not(".prevent-datatables").each(function(){if($(this).parent(".readonlyproperty").length>0)return;
if($(this).find("tr").length<1)return;var $me=$(this);var caption=$me.parent(".controls").data()&&$me.parent(".controls").data()["caption"]?$me.parent(".controls").data()["caption"]:"";var options=$.extend(true,{"paginate":false,"lengthChange":false,"autoWidth":true,"filter":true,"sort":true,"order":[],"info":false,"scrollY":"244px","scrollCollapse":true,"aoColumns":[],"fnInitComplete":function(){var $me=$(this);var $parent=$me.parents(".dataTables_wrapper");var $filter=$parent.find(".dataTables_filter");
var input=$filter.find("label").children("input");if($me.find("tbody tr").length>5){input.attr("placeholder",_Prtg.Lang.common.strings.search).detach();$filter.find("label").text("").append('<i class="icon-gray icon-search"></i>').append(input).find("i").on("click."+self.namespace,function(){$(this).next().val("").trigger(new $.Event("keyup"))})}else if(!!caption)$filter.children().hide();else $filter.hide();$('input:radio[checked="checked"]',this).prop("checked",true);$parent.find(".dataTables_scrollHeadInner").css("width",
"");self.$el.find('.datatables tbody .checkboxholder [type="checkbox"]:hidden').addClass("validateme")}},$me.data().options||{});$me.find("th").each(function(){if($(this).is(".no_sort"))options.aoColumns.push({"bSortable":false});else options.aoColumns.push(null)});$me.find("td").each(function(index,elm){if($(this).find("select").length>0)$(this).addClass("fixedwidth")});self.dataTables.push($me.dataTable(options));$me.closest("fieldset,.groupshowhideelement").one("groupshow."+self.namespace,function(e){var meHeight=
$me.height()-15;options.scrollY=meHeight<244?meHeight+"px":"244px";self.dataTables[self.dataTables.length-1].fnAdjustColumnSizing()});$me.parents(".dataTables_wrapper").find(".dataTables_filter").prepend(caption);if($me.find('input[type="checkbox"]').length){$me.on("click."+self.namespace,"tr",function(event){var $this=$(this);var $checkbox=$this.find("input.checkbox:first");if($(event.target).is("th"))return;$checkbox.prop("checked",!$checkbox.is(":checked")).trigger("change");$this.toggleClass("ui-selected",
$checkbox.is(":checked"));$me.parent().prev().find("tr th:first-child input:checkbox").prop("checked",$me.find("tbody tr td:first-child input").not(":checked").length===0)});$me.find("tbody").selectable({create:function(event,ui){$(this).find('td input[type="checkbox"]:checked').each(function(i,elm){$(elm).parents("tr").addClass("ui-selected")})},start:function(){$me.parents(".dataTables_wrapper").find(".checkboxtoggler").prop("checked",false).trigger("change")},selecting:function(event,ui){$(ui.selecting).find("input.checkbox:first").prop("checked",
true).trigger("change")},unselecting:function(event,ui){$(ui.unselecting).find("input.checkbox:first").prop("checked",false).trigger("change")},selected:function(e,ui){$(ui.selected).find("input.checkbox:first").prop("checked",true).trigger("change");if($me.find("tbody tr td:first-child input").not(":checked").length===0)$me.parent().prev().find("tr th:first-child input:checkbox").prop("checked",true)},filter:"tr",distance:15,cancel:"a, input, option, .notselectable, select"})}if($me.find("tbody tr td:first-child input").not(":checked").length===
0)$me.parent().prev().find("tr th:first-child input:checkbox").prop("checked",true)});if(!this.$el.hasClass("assistent"))this.$el.parents(".ui-dialog").find(".ui-dialog-buttonpane .actionbutton").addClass("button btngrey submit").removeClass("actionbutton ");this.initEvents();if(this.initUpdateFloatingButtons().length>0)this.updateFloatingButtons();this.$el.find(".fieldrequired").addClass("required");this.$el.find("input[editable]").each(function(){var $me=$(this);$me.parent().append('<i class="locked icon-locked">').attr("title",
_Prtg.Lang.common.strings.editrequest).attr("data-original-title",_Prtg.Lang.common.strings.editrequest).find("i").on("click."+self.namespace,function(){var that=$(this);if(that.hasClass("icon-locked"))if(confirm(_Prtg.Lang.common.strings.editrequest)){$me.removeAttr("disabled readonly").focus();that.removeClass("icon-locked").addClass("icon-unlocked")}})});if(!!!this.data.inline)this.$el.find("input:visible:not(.ui-autocomplete-input), textarea:visible").eq(0).focus();_Prtg.Events.publish("forminitialized.prtg")};
prtgForm.prototype.initEvents=function(){var self=this;var highlight_=$.validator.defaults.highlight;var unhighlight_=$.validator.defaults.unhighlight;if(self.$el.hasClass("clusterselector")){this.$el.on("change."+self.namespace,'input[name="clgid"]',function(e){var url=$(".tab-active").find("a").attr("href");if(url){$(".tab-active").find("a").attr("href",url.split("?")[0]+"?"+self.$el.serialize());_Prtg.Plugins["prtg-tabs"]["plugin"].activateTab($(".tab-active").attr("tabid"));$(".tab-active").find("a").attr("href",
url)}else{url=_Prtg.Util.getUrlParameters(window.location.href);url.clgid=$(this).val();window.location.href=window.location.href.split("?")[0]+"?"+Object.keys(url).map(function(e){return e+"="+encodeURIComponent(url[e])}).join("&")}});return}self.$el.on("destroyed."+self.namespace,{"self":self},self.destroy);this.$el.find("textarea").on("focus."+self.namespace,function(){var val=this.value;this.value="";this.value=val});this.$el.off("click."+self.namespace+" change."+self.namespace,".GroupShowHide",
this.groupShowHideHandler);this.$el.on("click."+self.namespace+" change."+self.namespace,".GroupShowHide",{self:this},this.groupShowHideHandler);var scrollTimer=null;this.$el.find(".submitbuttonboxanchor").scrollParent().not("html").add(window).slice(0,1).on("scroll."+self.namespace,function(){self.updateFloatingButtons.call(self)});if(self.$el.attr("id")==="addobjectdialogform"){self.$el.find('input.notconnectedAll[data-rule-required="true"]').addClass("validateme");self.$el.find('input.connectedAll[data-rule-required="true"]').addClass("validateme")}self.$el.validate({errorClass:"validateerror",
errorElement:"div",ignore:'fieldset.collapsed *, :hidden:not(.validateme), .datatables:hidden tbody .checkboxholder [type="checkbox"]:hidden',errorPlacement:function(label,$element){if($("#devicetemplate__check-error").length>0)return;if($element.hasClass("checkbox"))$element.parents(".dataTables_wrapper").append(label);else $element.parent().append(label)},highlight:function(element,errorClass,validClass){highlight_(element,errorClass,validClass);if(!!$(element).data("validateRelated"))highlight_($($(element).data("validateRelated")),
"validateerror2",validClass)},unhighlight:function(element,errorClass,validClass){unhighlight_(element,errorClass,validClass);if(!!$(element).data("validateRelated"))unhighlight_($($(element).data("validateRelated")),"validateerror2",validClass)}});this.$el.on("change."+self.namespace+" keyup."+self.namespace,'[needsserverrestart="true"], [needsserverrestart="true"]>*',function(e){self.needsserverrestart=true});this.$el.on("change."+self.namespace+" keyup."+self.namespace+" formchange."+self.namespace,
function(e){if($(e.target).hasClass("initilizing"))return false;self.highLightSave();self.$el.valid();self.$el.addClass("formchanged")});if(this.data.historyform)this.$el.on("click."+self.namespace,".submit",{self:this},this.runhistoryform);this.$el.find('input[name="name_"]').each(function(){self.$name_=$(this);self.$name_.data().oldValue=self.$name_.val()});this.$el.on("submit."+self.namespace,{"self":self},self.submitFormHandler);this.$el.on("click."+self.namespace,".checkboxtoggler",function(e){var $this=
$(this);var $table=$this.parents(".dataTables_wrapper").find("table.datatables");var checkstate=$this.is(":checked");$table.find('input[type="checkbox"]').each(function(){$(this).prop("checked",checkstate).parents("tr").toggleClass("ui-selected",checkstate).triggerHandler("change")})});setTimeout(function(){self.$el.valid()},1)};prtgForm.prototype.highLightSave=function(){this.$el.find(".submit").addClass("actionbutton").removeClass("btngrey button");this.$el.parents(".ui-dialog").find(".ui-dialog-buttonpane .submit").addClass("actionbutton").removeClass("btngrey button")};
prtgForm.prototype.getUserTags=function($elm){$.getJSON("api/usertags.json",function(data,status,xhr){$elm.autocomplete({source:data["tags"]})})};prtgForm.prototype.submitFormHandler=function(event){var self=event.data.self;if(!self.$el.valid()){event.preventDefault();return}for(var i=0;i<self.dataTables.length;i++)self.dataTables[i].api().search("").columns().search("").draw();if(self.needsserverrestart){event.preventDefault();_Prtg.Dialogs.serverRestartNeededDialog().done(function(){self.needsserverrestart=
false;self.dorestart=true;self.$el.trigger("submit")})}else self.submitForm(event)};prtgForm.prototype.submitForm=function(event){var self=event.data.self;var formAction=self.$el.attr("action");var loadingDialog=_Prtg.Dialogs.loader(_Prtg.Lang.Dialogs.strings.multieditdialogtitle);if(self.$el.is("#reportrunnerform"))if($("#report_html").prop("checked")===true){$("#reportrunnerform").attr("target","prtg_"+Math.floor(Math.random()*1E7));loadingDialog.dialog("destroy").remove()}else $("#reportrunnerform").attr("target",
"");if($("#mainstuff").hasClass("wingui"))return;if(self.$el.find('input[type="file"]').length)return;if(self.data["ajaxsubmit"]!==undefined&&self.data["ajaxsubmit"]){var formData=_Prtg.Util.getFormData(self.$el);if(Object.keys(formData).length){event.preventDefault();$.ajax({url:formAction,data:formData,type:"POST",dataType:"html",beforeSend:function(jqXHR){jqXHR.gotoAfterError=false;jqXHR.peNumber="03456"},success:function(){if(self.dorestart)if(window.winGUI)alert("restartserver");else _Prtg.Dialogs.serverRestartingDialog();
else if(self.data.hasOwnProperty("redirect")&&self.data["redirect"]===false){_Prtg.Events.publish("refresh.events.prtg",[true]);if(!!self.$name_&&self.$name_.val()!==self.$name_.data().oldValue&&/editsettings/.test(formAction)===true||/deleteobject|addgroup2|adddevice2|addmap2|duplicateobject|moveobjectnow|deletesub/.test(formAction)===true)$("#main_menu").parent().load("/controls/menu.htm")}else if(self.$el.hasClass("dialogform"))self.$el.parents(".ui-dialog").find(".ui-dialog-buttonpane .submit").addClass("btngrey button").removeClass(" actionbutton");
else{$("body").remove();if(formAction=="addsensor5.htm")location.href="/device.htm?id="+formData.id;else if(formData["targeturl"])location.href=formData["targeturl"];else location.href=location.href.replace(/&tabid=[a-zA-Z0-9]+/,"").replace(/tabid=[a-zA-Z0-9]+&/,"").replace(/\?tabid=[a-zA-Z0-9]+$/,"")}}}).always(function(){if(loadingDialog.hasClass("ui-dialog-content"))loadingDialog.dialog("destroy").remove();self.$el.removeClass("formchanged")})}}};prtgForm.prototype.initUpdateFloatingButtons=function(){var $submitbox=
this.$el.find(".submitbuttonbox");var $anchor=$submitbox.closest(".submitbuttonboxanchor");var $scrollContainer=$anchor.scrollParent().not("html").add(window).slice(0,1);var submitBoxHeight=$submitbox.outerHeight();this.floatButtonProperties={"$submitbox":$submitbox,"$anchor":$anchor,"$scrollContainer":$scrollContainer,"submitBoxHeight":$submitbox.outerHeight()+35};return $anchor};prtgForm.prototype.updateFloatingButtons=function(){var self=this;if(self.floatButtonProperties["$submitbox"].length<
1||self.floatButtonProperties["$anchor"].length<1)return;var docViewTop=self.floatButtonProperties["$scrollContainer"].scrollTop();docViewBottom=docViewTop+self.floatButtonProperties["$scrollContainer"].height()+(self.floatButtonProperties["$scrollContainer"].offset()||{top:0}).top,elemTop=self.floatButtonProperties["$anchor"].offset().top+(self.floatButtonProperties["$scrollContainer"].offset()?self.floatButtonProperties["$scrollContainer"].scrollTop():0),elemBottom=elemTop+self.floatButtonProperties["submitBoxHeight"];
if(!(docViewTop<elemTop&&docViewBottom>elemBottom))self.floatButtonProperties["$submitbox"].toggleClass("float",true);else self.floatButtonProperties["$submitbox"].toggleClass("float",false)};prtgForm.prototype.groupShowHideHandler=function(e,forceHide){var $this=$(this);var self=e.data.self;var thisId=$this.is("select")?$this.children(":selected").attr("id"):$this.attr("id");var $hideId=$(".Hide"+thisId+":not(.multieditactivecheckbox)");var $showId=$(".Show"+thisId+":not(.multieditactivecheckbox)");
if($this.prop("checked")||$this.is("select")||forceHide){if(forceHide)$showId=$();if($hideId.is("visible")){$(".Hide"+thisId+":visible").hide();$hideId.hide();$showId.show("highlight").css("display","block").removeClass("InitialDisplayNone");$hideId.trigger("grouphide."+self.namespace)}else{$hideId.hide();$showId.show("highlight").css("display","block").removeClass("InitialDisplayNone");$showId.trigger("groupshow."+self.namespace)}var $gsh;$hideId.each(function(i,elm){$gsh=$(elm).find(".GroupShowHide");
if($gsh.length)$gsh.each(function(index,elm2){self.groupShowHideHandler.call(elm2,{"data":{"self":self}},true)})});$showId.each(function(i,elm){$gsh=$(elm).find(".GroupShowHide");if($gsh.length)$gsh.each(function(index,elm2){self.groupShowHideHandler.call(elm2,{"data":{"self":self}})})})}else{$(".HideNot"+thisId+":visible").hide();$(".ShowNot"+thisId).show("highlight")}};prtgForm.prototype.runhistoryform=function(e){var self=e.data.self;if(!self.$el.valid()||self.$el.find(".validateerror2").length>
0){e.preventDefault();return}var myid;if(typeof myid=="undefined")myid=$("#myid").val();if(typeof myid=="undefined")myid=$(".sensorlookupnew").attr("selid");if(typeof myid=="undefined")myid=$('input[name="id"]:hidden').val();var params="?id="+myid+"&sdate="+$("#sdate").val()+"&edate="+$("#edate").val()+"&avg="+$("#avg").val()+"&pctavg="+$("#pctavg").val()+"&pctshow="+$("#pctshow").prop("checked")+"&pct="+$("#pct").val()+"&pctmode="+$("#pctmode1").prop("checked");var clusterid=$('input[name="clgid"]:checked').val();
if(clusterid)params=params+"&clgid="+clusterid;if($("#hiddenchannels").length>0&&$("#hiddenchannels").val()!=="")params+="&hide="+$("#hiddenchannels").val();if($("#formathtml").prop("checked")){var windowname="HistoricDataWindow"+parseInt(Math.random()*1E6,10);var mywindow=window.open("/generatehistoricdata.htm?id="+myid+"&generate="+encodeURIComponent("/historicdata_html.htm"+params),windowname,"width=900,height=600,scrollbars=yes,toolbar=yes,location=yes,status=yes,menubar=yes,resizable=yes");mywindow.focus()}else if($("#formatxml").prop("checked")===
true)window.top.location.href="/api/historicdata.xml"+params;else if($("#formatcsv").prop("checked")===true)window.top.location.href="/api/historicdata.csv"+params;e.preventDefault()};prtgForm.prototype.destroy=function(event){var self=event.data.self;self.$el.find(".submitbuttonboxanchor").scrollParent().not("html").add(window).off("."+self.namespace);$(document).off("."+self.namespace);self.$el.off("."+self.namespace);self.$el.off("."+self.namespace)};$.fn[pluginName]=function(data,parent){return this.each(function(){if(!$.data(this,
"plugin_"+pluginName))$.data(this,"plugin_"+pluginName,new prtgForm(this,data,parent))})}})(jQuery,window,document);

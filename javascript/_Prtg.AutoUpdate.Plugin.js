(function($,window,document,undefined){var pluginName="autoupdate";function autoupdate(element,data,parent){this.data=data;this.el=!(element instanceof jQuery)?element:element[0];this.$el=!(element instanceof jQuery)?$(element):element;this.initEvents();this.hadNoConnection=false;this.connectionInterval}autoupdate.prototype.initEvents=function(){var self=this;this.$el.on("click","#triggerdownloadupdate",function(e){e.preventDefault();$("#results").load("/api/autoupdatedownload.htm");$("#install_p").hide();
$("#download_p").hide();$("#download_loader").show();_Prtg.Events.stop("refresh")}).on("click","#beforeinstallupdate",function(e){e.preventDefault();$("#beforeinstall").dialog({closeOnEscape:false,draggable:false,modal:true,resizable:false,height:350,title:'<#langjs key="html.autoupdate.important" default="Important">',width:450,buttons:[{"html":'<#langjs key="html.autoupdate.installnow" default="Yes, install update now">',"class":"actionbutton","click":function(e){$(this).dialog("destroy");self.accepteula()}},
{"html":'<#langjs key="html.autoupdate.dont" default="No, do not install">',"class":"button btngrey","click":function(e){$(this).dialog("destroy")}}]})})};autoupdate.prototype.accepteula=function(){var self=this;var mydiv="#eula";if('<#system type="language">'=="de")mydiv="#eula_de";$(mydiv).show().dialog({"closeOnEscape":false,"draggable":false,"modal":true,"resizable":false,"height":450,"title":'<#langjs key="html.autoupdate.terms2" default="Please Accept the General License Terms and Conditions">',
"width":550,"buttons":[{"html":'<#langjs key="html.autoupdate.accept" default="Accept License Terms">',"class":"actionbutton","click":function(e){$(this).dialog("destroy");self.triggerinstallupdate()}},{"html":'<#langjs key="html.autoupdate.dontaccept" default="Cancel">',"class":"button btngrey","click":function(e){$(this).dialog("destroy")}}]})};autoupdate.prototype.triggerinstallupdate=function(){var self=this;_Prtg.Events.stop();$("#results").load("/api/autoupdateinstall.htm");$("#resultstable").show();
$("#install_p").hide();$("#download_p").hide();$("#resultstable").dialog({"closeOnEscape":false,"draggable":false,"modal":true,"resizable":false,"height":400,"width":450})};autoupdate.prototype.connectionCheck=function(){var self=this;this.connectionTrys=this.connectionTrys+1;$("#checking").append(" .");$.ajax({url:"/welcome.htm?id=0",type:"GET",global:false,timeout:5E3,dataType:"html",error:function(xhr,textStatus,errorThrown){self.hadNoConnection=true;return false},success:function(response,status,
xmlHttpRequest){if(response.length>0&&self.hadNoConnection){clearInterval(self.connectionInterval);window.location.reload()}else return false}})};_Prtg.Plugins.registerPlugin(pluginName,autoupdate)})(jQuery,window,document);var hadNoConnection=false;
function connectionCheck(){_Prtg.Events.stop();$("#checking").append(" .");$.ajax({url:"/welcome.htm?id=0",type:"GET",global:false,timeout:5E3,dataType:"html",error:function(xhr,textStatus,errorThrown){hadNoConnection=true;setTimeout(connectionCheck,1E3);return false},success:function(response,status,xmlHttpRequest){if(response.length>0&&hadNoConnection)window.location.reload();else{setTimeout(connectionCheck,1E3);return false}}})};

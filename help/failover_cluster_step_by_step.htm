<!--Failover Cluster Step by Step-->


<div id="main">
  <div id="head">
     <div class="buttonbox">
       <a href="/help/index.htm" class="manual-content-icon">Content</a>
       <span class="spacer"></span><a href="failover_cluster_configuration.htm" class="manual-previous-icon">Previous</a>
       <span class="spacer"></span><a href="data_storage.htm" class="manual-next-icon">Next</a>
     </div>
     PRTG Manual: <b>Failover Cluster Step by Step</b>
  </div> 


  <div id="content">
    <div class="tabs-container help"> 
      <h1><%NUMBERING1%>.<%NUMBERING2%>.<%NUMBERING3%> PRTG Manual: Failover Cluster Step by Step</h1> 
      <p>This section will guide you through a step-by-step process to set up a failover cluster. Please follow these instructions carefully to successfully integrate two or more PRTG installations into one failover cluster. </p>
<p><img src="icon-i-round-red.png" width="17" height="17" alt="icon-i-round-red" style="float:left;margin:0px 10px 10px 0px; border:none" />Before getting started, please make sure you consider the information in section <span class="f_BoldCustom"><a href="failover_cluster_configuration.htm" class="topiclink">Failover Cluster Configuration</a></span>.</p>
<p><img src="icon-prtg-on-demand.png" width="17" height="17" alt="icon-prtg-on-demand" style="float:left;margin:0px 10px 10px 0px; border:none" />This feature is not available in PRTG in the cloud.</p>
<p class="p_InTopicHeading"><a id="1"></a><span class="f_InTopicHeading">Step 1: Install Core Servers</span></p>
<p>We will start with setting up a single failover cluster, consisting of two PRTG core server installations, each running on an individual server. Please use your license key twice to install the PRTG core server on two different computers.</p>
<p>If you already run an installation of PRTG, this will be your future Master Node. In this case, please install a second core server on another computer only. Make sure you use the same license key for both installations.</p>
<p><span class="f_ListBulleted">Before you start to set up a cluster, please make sure you run exactly the same PRTG version (build number) on all (future) nodes (install updates for existing installations, if necessary).</span><span class="f_ListBulleted"> </span></p>
<p><img src="icon-i-round.png" width="17" height="17" alt="icon-i-round" style="float:left;margin:0px 10px 10px 0px; border:none" /><span class="f_ListBulleted">Once the cluster is established, any updates you install on one node will be deployed to all other cluster nodes automatically.</span></p>
<p><img src="icon-book-arrows.png" width="17" height="17" alt="icon-book-arrows" style="float:left;margin:0px 10px 10px 0px; border:none" />For details about the installation process, please see <span class="f_BoldCustom"><a href="install_a_prtg_core_server.htm" class="topiclink">Install a PRTG Core Server</a></span>.</p>
<p class="p_InTopicHeading"><a id="2"></a><span class="f_InTopicHeading">Step 2: Configure Master Node</span></p>
<p>Decide which of your PRTG core server installations will be your future Master Node. If you already run an installation of PRTG in your network for some time, this should be your master, so your existing monitoring configuration is being kept.</p>
<p>On the Master Node server, from the Windows start menu, open the <span class="f_BoldCustom"><a href="prtg_server_administrator.htm#cluster" class="topiclink">PRTG Administration Tool</a></span>. On the Cluster tab, click on the following button:</p>
<p class="p_BoldCustom"><span class="f_BoldCustom">Create a PRTG Cluster...</span></p>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_ListBulleted">Click this button to start creating a cluster. The current PRTG core server will then be the </span><span class="f_BoldCustom">Master Node</span><span class="f_ListBulleted"> of your cluster. </span></li>
<li><span class="f_ListBulleted">Click </span><span class="f_BoldCustom">Yes</span><span class="f_ListBulleted"> to confirm the conversion of this installation into a cluster master node.</span></li>
</ul>
<div class="p_ImageCaption"><div style="width:408px;padding:0px"><img src="admin_clustercreate_zoom83.png" width="408" height="164" style="border:none" alt="Converting an Installation into a Cluster Master Node" title="Converting an Installation into a Cluster Master Node" /><p style="text-align:center"><span class="f_ImageCaption">Converting an Installation into a Cluster Master Node</span></p></div></div>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_ListBulleted">A new dialog box will appear.</span></li>
</ul>
<div class="p_ImageCaption"><div style="width:410px;padding:0px"><img src="admin_mastercreate_zoom85.png" width="410" height="217" style="border:none" alt="PRTG Administrator: Creating a Cluster Master" title="PRTG Administrator: Creating a Cluster Master" /><p style="text-align:center"><span class="f_ImageCaption">PRTG Administrator: Creating a Cluster Master</span></p></div></div>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_ListBulleted">Enter a </span><span class="f_BoldCustom">Cluster Port</span><span class="f_ListBulleted">. This is the port on which the internal communication between the different cluster nodes is sent. Make sure connections between cluster nodes are possible on the selected port.</span></li>
<li><span class="f_ListBulleted">Enter or paste a </span><span class="f_BoldCustom">Cluster Access Key</span><span class="f_ListBulleted">. This is a unique access key. All nodes in a cluster have to be configured with the same cluster access key in order to join the cluster. Connection attempts with the wrong access key will be rejected.</span></li>
</ul>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_ListBulleted">We recommend that you use the default value.</span></li>
<li><span class="f_ListBulleted">Save the </span><span class="f_BoldCustom">Cluster Access Key</span><span class="f_ListBulleted"> so you have it at hand when configuring your </span><span class="f_BoldCustom">Failover Node(s)</span><span class="f_ListBulleted">.</span></li>
<li><span class="f_ListBulleted">After confirming your settings you will be asked to restart Windows services. Please do so in order for your changes to take effect.</span></li>
</ul>
<p class="p_InTopicHeading"><a id="3"></a><span class="f_InTopicHeading">Step 3: Configure Failover Node</span></p>
<p>On the server that will be your Failover Node, open the <span class="f_BoldCustom"><a href="prtg_server_administrator.htm#cluster" class="topiclink">PRTG Administration Tool</a></span>. On the Cluster tab, click the following button:</p>
<p class="p_BoldCustom"><span class="f_BoldCustom">Join a PRTG Cluster...</span> </p>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_ListBulleted">Click this button to add this installation to an existing cluster that already has a </span><span class="f_BoldCustom">Master Node</span><span class="f_ListBulleted">. The current PRTG core server will then be a </span><span class="f_BoldCustom">Failover Node </span><span class="f_ListBulleted">in the cluster. </span></li>
<li><span class="f_ListBulleted">This button is also available if you are currently running your PRTG installation in </span><span class="f_BoldCustom">Cluster Mode: Master Node</span><span class="f_ListBulleted">. This option will then change your master node to a failover node!</span></li>
<li><span class="f_ListBulleted">Click </span><span class="f_BoldCustom">Yes </span><span class="f_ListBulleted">to confirm the conversion of this installation into a failover node.</span></li>
</ul>
<div class="p_ImageCaption"><div style="width:390px;padding:0px"><img src="admin_tool_confirm_failover_zoom80.png" width="390" height="158" style="border:none" alt="Converting an Installation into a Cluster Failover Node" title="Converting an Installation into a Cluster Failover Node" /><p style="text-align:center"><span class="f_ImageCaption">Converting an Installation into a Cluster Failover Node</span></p></div></div>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_ListBulleted">A dialog box will appear. </span></li>
</ul>
<div class="p_ImageCaption"><div style="width:386px;padding:0px"><img src="admin_tool_join_cluster_zoom80.png" width="386" height="204" style="border:none" alt="PRTG Server Administrator" title="PRTG Server Administrator" /><p style="text-align:center"><span class="f_ImageCaption">PRTG Server Administrator</span></p></div></div>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_ListBulleted">Enter a </span><span class="f_BoldCustom">Master IP address/DNS name</span><span class="f_ListBulleted"> for your cluster</span>. It must be reachable from the machine running the failover node.</li>
<li><span class="f_ListBulleted">Enter the other settings as defined in the settings of your </span><span class="f_BoldCustom">Master Node.</span><span class="f_ListBulleted"> Please make sure you use the same settings on all nodes in your cluster.</span></li>
</ul>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_ListBulleted">Enter a </span><span class="f_BoldCustom">Cluster Port</span><span class="f_ListBulleted">. This is the port on which the internal communication between the different cluster nodes is sent. Make sure connections between cluster nodes are possible on the selected port.</span></li>
<li><span class="f_ListBulleted">Enter or paste a </span><span class="f_BoldCustom">Cluster Access Key</span><span class="f_ListBulleted">. This is a unique access key. All nodes in a cluster have to be configured with the same cluster access key in order to join the cluster. Connection attempts with the wrong access key will be rejected.</span></li>
</ul>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_ListBulleted">After confirming your settings you will be asked to restart Windows services. Please do so in order for your changes to take effect.</span></li>
</ul>
<p class="p_InTopicHeading"><a id="4"></a><span class="f_InTopicHeading">Step 4: Confirm Failover Node</span></p>
<p>Now you need to confirm the new failover node by setting it to <span class="f_BoldCustom">Active</span> in the master node's settings.</p>
<p>In a browser window, log in to the PRTG <a href="login.htm" class="topiclink">web interface</a> of the <span class="f_ItalicCustom">Master Node</span> server.</p>
<p>In the <span class="f_BoldCustom"><a href="cluster_settings.htm" class="topiclink">System Administration—Cluster</a></span> settings, you will see your “Master Node” server in the first line of the cluster list and your “Failover Node” server below.</p>
<p><img src="icon-i-round-red.png" width="17" height="17" alt="icon-i-round-red" style="float:left;margin:0px 10px 10px 0px; border:none" />If you use <a href="remote_probes_and_multiple_probes.htm" class="topiclink">remote probes</a> outside your local network, for each core server in the cluster use a DNS name or IP address that the probes can reach from the outside. Enter the entries in the <span class="f_BoldCustom"><a href="cluster_settings.htm#settings" class="topiclink">Cluster Node Setup</a></span> table accordingly (see below). The addresses must be valid for both the cluster nodes to reach each other and for remote probes to reach all cluster nodes individually. Remote probes outside your LAN cannot reach private IP addresses or DNS names!</p>
<div class="p_ImageCaption"><div style="width:497px;padding:0px"><img src="cluster_settings_detail_zoom46.png" width="497" height="261" style="border:none" alt="System Administration: Cluster Node Setup" title="System Administration: Cluster Node Setup" /><p style="text-align:center"><span class="f_ImageCaption">System Administration: Cluster Node Setup</span></p></div></div>
<p>For the “Failover Node”, set the radio button for <span class="f_BoldCustom">Node State</span> to <span class="f_BoldCustom">Active</span> and <span class="f_BoldCustom">Save</span> the changes. The nodes will now connect and exchange configuration data. This may take a few minutes.</p>
<p class="p_InTopicHeading"><a id="5"></a><span class="f_InTopicHeading">Step 5: Check Cluster Connection</span></p>
<p>In two browser windows, log in to the PRTG web interfaces of <span class="f_ItalicCustom">both</span> of your PRTG installations. Open the cluster status page in both windows by clicking on the narrow cluster information bars at the top of each window. You should see a cluster status with your two nodes in a <span class="f_BoldCustom">Connected </span>state after a few minutes.</p>
<div class="p_ImageCaption"><div style="width:433px;padding:0px"><img src="cluster_status.png" width="433" height="249" style="border:none" alt="PRTG Cluster Status" title="PRTG Cluster Status" /><p style="text-align:center"><span class="f_ImageCaption">PRTG Cluster Status</span></p></div></div>
<p class="p_InTopicHeading"><a id="6"></a><span class="f_InTopicHeading">Step 6: Trouble Shooting</span></p>
<p>Having any problems? If your nodes cannot connect, please see</p>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_ListBulleted">the cluster log entries on the </span><span class="f_BoldCustom"><a href="cluster_status.htm" class="topiclink">PRTG Status—Cluster Status</a></span><span class="f_ListBulleted"> page of the web interface</span></li>
<li>the core server log file, a text file in the logs directory of your PRTG data folder (see section <span class="f_BoldCustom"><a href="data_storage.htm" class="topiclink">Data Storage</a></span>).</li>
</ul>
<p>In the latest entries of these logs, you can see messages about any errors that might have occurred. These will give you hints on where to find a solution.</p>
<p>If you encounter connection problems between the two cluster nodes, please make sure no software or hardware firewall is blocking communication on the cluster port defined during cluster setup. Communication between the nodes must be possible in <span class="f_ItalicCustom">both directions</span> in order for the cluster to work properly.</p>
<p class="p_InTopicHeading"><a id="7"></a><span class="f_InTopicHeading">Step 7: Move Sensors to the Cluster Probe Now</span></p>
<p>That’s it. You have successfully set up your failover cluster. All devices that you create or move under the <span class="f_BoldCustom">Cluster Probe</span> are monitored by both servers.</p>
<p><span class="f_BoldCustom">To monitor your existing configuration via all cluster nodes, on your master node, please move your groups, devices, and sensors from the local probe to the cluster probe!</span> Objects, including their settings, will then be transferred to all cluster nodes automatically.</p>
<p class="p_InTopicHeading"><a id="8"></a><span class="f_InTopicHeading">Step 8: Move Custom Content to Failover Nodes</span></p>
<p>On startup of the cluster master node, <a href="maps.htm" class="topiclink">maps</a> and <a href="define_lookups.htm" class="topiclink">custom lookups</a> are automatically transmitted to the failover nodes. While changes to maps are automatically synchronized, you have to manually <a href="define_lookups.htm#loading" class="topiclink">(re-)load lookups</a> on all nodes. Other custom content has to be copied manually from the according <a href="data_storage.htm" class="topiclink">folders</a> on the master node to the same folders on the failover nodes: </p>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_ListBulleted"><a href="create_device_template.htm" class="topiclink">Device templates</a>: </span><span class="f_BoldCustom">\devicetemplates</span><span class="f_ListBulleted"> subfolder of PRTG</span></li>
<li><span class="f_ListBulleted"><a href="additional_sensor_types.htm" class="topiclink">Custom sensors</a>: </span><span class="f_BoldCustom">\Custom Sensors</span><span class="f_ListBulleted"> subfolder of PRTG </span></li>
<li><span class="f_ListBulleted"><a href="snmp_monitoring.htm#understand" class="topiclink">MIB files</a>: </span><span class="f_BoldCustom">\MIB</span><span class="f_ListBulleted"> subfolder of PRTG</span></li>
<li><span class="f_ListBulleted"><a href="snmp_library_sensor.htm#add" class="topiclink">SNMP libraries</a>: </span><span class="f_BoldCustom">\snmplibs</span><span class="f_ListBulleted"> subfolder of PRTG</span></li>
<li><span class="f_ListBulleted"><a href="notifications_settings.htm" class="topiclink">Notifications</a>: </span><span class="f_BoldCustom">\Notfications</span><span class="f_ListBulleted"> subfolder of PRTG</span></li>
<li><span class="f_ListBulleted">The </span><span class="f_BoldCustom">\webroot</span><span class="f_ListBulleted"> subfolder of PRTG if you customized the PRTG web interface, for example</span></li>
</ul>
<p class="p_InTopicHeading"><a id="additional"></a><span class="f_InTopicHeading">Add More Failover Nodes</span></p>
<p>If you want to add an additional failover node to your cluster, you will need an additional license key for two and three failover nodes, and two additional license keys to run four failover nodes. </p>
<p><img src="icon-i-round.png" width="17" height="17" alt="icon-i-round" style="float:left;margin:0px 10px 10px 0px; border:none" />In a cluster, only core servers running on the same size of <a href="available_licenses.htm" class="topiclink">license</a> can be combined. For example, you can use several &quot;PRTG 5000&quot; licenses or several &quot;PRTG 1000&quot; licenses in one cluster. To add another failover node to your cluster, please set up a new PRTG core server installation on a new server, using an additional license key. Then proceed with <span class="f_BoldCustom"><a href="failover_cluster_step_by_step.htm#3" class="topiclink">Step 3</a></span> and following. Use a second license key to set up both your second and third failover node, and use a third license key to set up your fourth failover node. Each failover cluster is technically limited to five cluster nodes: as a maximum, you can run one master node and four failover nodes in one cluster.</p>
<p><img src="icon-i-round-red.png" width="17" height="17" alt="icon-i-round-red" style="float:left;margin:0px 10px 10px 0px; border:none" /><span class="f_ListBulleted">Stay below 2,500 sensors per cluster for best performance in a single failover. Clusters with more than 5,000 sensors are not supported. For each additional failover node, divide the number of sensors by two.</span></p>
<p class="p_InTopicHeading"><a id="more"></a><span class="f_InTopicHeading">More</span></p>
<p class="p_ListBulleted"><span class="f_ListBulleted">Knowledge Base: My PRTG Cluster is messed up. How can I start over?</span></p>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_ListBulleted"><a href="https://kb.paessler.com/en/topic/41903?utm_source=prtg&utm_medium=webgui&utm_campaign=kb" target="_blank" class="weblink">https://kb.paessler.com/en/topic/41903</a></span></li>
</ul>
<p class="p_InTopicHeading"><a id="topics"></a><span class="f_InTopicHeading">Advanced Topics</span></p>
<ul style="text-indent:0px; margin-left: 13px;list-style-position:outside;">
<li><span class="f_BoldCustom"><a href="active_directory_integration.htm" class="topiclink">Active Directory Integration</a></span></li>
<li><span class="f_BoldCustom"><a href="application_programming_interface_api_definition.htm" class="topiclink">Application Programming Interface (API) Definition</a></span></li>
<li><span class="f_BoldCustom"><a href="xflow_packet_sniffer_filter_rules.htm" class="topiclink">Filter Rules for xFlow, IPFIX, and Packet Sniffer Sensors</a></span></li>
<li><span class="f_BoldCustom"><a href="xflow_packet_sniffer_channel_definitions.htm" class="topiclink">Channel Definitions for xFlow, IPFIX, and Packet Sniffer Sensors</a></span></li>
<li><span class="f_BoldCustom"><a href="define_ip_ranges.htm" class="topiclink">Define IP Ranges</a></span></li>
<li><span class="f_BoldCustom"><a href="define_lookups.htm" class="topiclink">Define Lookups</a></span></li>
<li><span class="f_BoldCustom"><a href="regular_expressions.htm" class="topiclink">Regular Expressions</a></span></li>
<li><span class="f_BoldCustom"><a href="add_remote_probe.htm" class="topiclink">Add Remote Probe</a></span></li>
<li><span class="f_BoldCustom"><a href="failover_cluster_configuration.htm" class="topiclink">Failover Cluster Configuration</a></span></li>
<li><span class="f_BoldCustom"><a href="data_storage.htm" class="topiclink">Data Storage</a></span></li>
<li><span class="f_BoldCustom"><a href="using_your_own_ssl_certificate.htm" class="topiclink">Using Your Own SSL Certificate</a></span></li>
<li><span class="f_BoldCustom"><a href="calculating_percentiles.htm" class="topiclink">Calculating Percentiles</a> </span></li>
</ul>

    </div>
    <p><small>Keywords: </small></p>
  </div>
  <div class="buttonbox">
  <div id="manual-navigation">
       <a href="/help/index.htm" class="manual-content-icon">Content</a>
       <span class="spacer"></span><a href="failover_cluster_configuration.htm" class="manual-previous-icon">Previous</a>
       <span class="spacer"></span><a href="data_storage.htm" class="manual-next-icon">Next</a>
  </div>
  </div>
</div>



